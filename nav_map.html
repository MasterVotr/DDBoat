<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Visualization Debug</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        #ip-form, #data-display { margin-bottom: 20px; }
        #log { background-color: #f0f0f0; padding: 10px; height: 200px; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>GPS Visualization Debug</h1>
    
    <div id="ip-form">
        <input type="text" id="ip-address" placeholder="Enter IP address (e.g., 172.20.25.205)">
        <button onclick="setDataSource()">Set Data Source</button>
    </div>

    <div id="data-display">
        <h2>Latest Data:</h2>
        <pre id="latest-data">No data received yet.</pre>
    </div>

    <button onclick="fetchData()">Fetch Data (Manual)</button>

    <h2>Log:</h2>
    <div id="log"></div>

    <script>
        const socket = io();
        
        function setDataSource() {
            const ip = document.getElementById('ip-address').value;
            fetch('/set_data_source', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `ip=${ip}`
            })
            .then(response => response.json())
            .then(data => {
                log(`Data source set: ${data.message}`);
            })
            .catch(error => log(`Error setting data source: ${error}`));
        }

        function fetchData() {
            socket.emit('fetch_data');
        }

        socket.on('new_data', (data) => {
            document.getElementById('latest-data').textContent = JSON.stringify(data, null, 2);
            log(`Received new data: ${JSON.stringify(data)}`);
        });

        socket.on('error', (data) => {
            log(`Error: ${data.message}`);
        });

        function log(message) {
            const logElement = document.getElementById('log');
            logElement.innerHTML += `<div>${new Date().toISOString()}: ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Log when connected to the server
        socket.on('connect', () => {
            log('Connected to server');
        });
    </script>
</body>
</html>